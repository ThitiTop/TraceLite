[SERVICE]
    Flush         1
    Daemon        Off
    Log_Level     info
    Parsers_File  /fluent-bit/etc/parsers.conf
    storage.path  /var/lib/fluent-bit/storage
    storage.sync  normal

[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Tag               app.*
    Parser            json
    Skip_Empty_Lines  On
    Read_from_Head    On
    Refresh_Interval  1
    DB                /var/lib/fluent-bit/tail.db
    Mem_Buf_Limit     100MB
    storage.type      filesystem
    Skip_Long_Lines   On

[FILTER]
    Name              modify
    Match             app.*
    Add               host ${HOSTNAME}
    Add               env ${ENV}
    Add               service ${SERVICE_NAME}
    Add               version ${SERVICE_VERSION}

[OUTPUT]
    Name              http
    Match             app.*
    Host              collector
    Port              8443
    URI               /v1/ingest/logs
    Format            json_lines
    Compress          gzip
    tls               On
    tls.verify        Off
    Header            Authorization Bearer ${LOG_SHIP_TOKEN}
    Retry_Limit       False
